{% extends "base.html" %}

{% block title %}Keg {{ keg.keg_number }} - BROEN SBMS{% endblock %}

{% block content %}
<div class="keg-detail">
    <div class="page-header">
        <h1>Keg #{{ keg.keg_number }}</h1>
        <div class="actions">
            <a href="{{ url_for('update_keg', keg_id=keg.id) }}" class="btn btn-primary">Update Keg</a>
            <a href="{{ url_for('kegs') }}" class="btn btn-secondary">Back to Kegs</a>
        </div>
    </div>

    <div class="keg-info">
        <div class="info-grid">
            <div class="info-card">
                <h3>Basic Information</h3>
                <dl>
                    <dt>Keg Number:</dt>
                    <dd>{{ keg.keg_number }}</dd>
                    
                    <dt>Size:</dt>
                    <dd>{{ keg.volume_liters }}L</dd>
                    
                    <dt>Condition:</dt>
                    <dd>{{ keg.condition }}</dd>
                    
                    <dt>Location:</dt>
                    <dd>{{ keg.location or 'Unknown' }}</dd>
                </dl>
            </div>

            <div class="info-card">
                <h3>Contents & Status</h3>
                <dl>
                    {% if keg.contents %}
                    <dt>Contents:</dt>
                    <dd>{{ keg.contents }}</dd>
                    {% endif %}
                    
                    <dt>Status:</dt>
                    <dd><span class="status-{{ keg.status|lower|replace(' ', '-')|replace('/', '-') }}">{{ keg.status }}</span></dd>
                    
                    <dt>Amount Left:</dt>
                    <dd>{{ "%.1f"|format(keg.amount_left_liters) }}L</dd>
                    
                    {% if keg.abv %}
                    <dt>ABV:</dt>
                    <dd>{{ "%.1f"|format(keg.abv) }}%</dd>
                    {% endif %}
                    
                    {% if keg.gluten_free %}
                    <dt>Dietary:</dt>
                    <dd><span class="badge badge-gluten-free">ðŸŒ¾ {{ _('Gluten Free') }}</span></dd>
                    {% endif %}
                    
                    {% if keg.date_filled %}
                    <dt>Date Filled:</dt>
                    <dd>{{ keg.date_filled.strftime('%d-%m-%Y') }}</dd>
                    {% endif %}
                </dl>
            </div>

            {% if keg.brew_id %}
            <div class="info-card">
                <h3>Brew Information</h3>
                <dl>
                    <dt>Brew:</dt>
                    <dd>{{ keg.brew_name }}</dd>
                    
                    <dt>Recipe:</dt>
                    <dd>{{ keg.recipe_name or 'Unknown' }}</dd>
                    
                    <dt>Style:</dt>
                    <dd>{{ keg.style or 'Unknown' }}</dd>
                    
                    <dt>Date Brewed:</dt>
                    <dd>{{ keg.date_brewed.strftime('%d-%m-%Y') if keg.date_brewed else 'Unknown' }}</dd>
                </dl>
            </div>
            {% endif %}
        </div>

        {% if keg_history %}
        <div class="keg-history">
            <h2>Keg History</h2>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>{{ _('Date') }}</th>
                        <th>{{ _('Contents') }}</th>
                        <th>{{ _('Status') }}</th>
                        <th>{{ _('Amount Left') }}</th>
                        <th>{{ _('Location') }}</th>
                        <th>{{ _('Event/Occasion') }}</th>
                        <th>{{ _('Notes') }}</th>
                        <th>{{ _('Actions') }}</th>
                    </tr>
                </thead>
                <tbody>
                    {% for entry in keg_history %}
                    <tr>
                        <td>{{ entry.recorded_date.strftime('%d-%m-%Y') if entry.recorded_date else 'Unknown' }}</td>
                        <td>{{ entry.contents or 'Empty' }}</td>
                        <td><span class="status-{{ entry.status|lower|replace(' ', '-')|replace('/', '-') }}">{{ entry.status }}</span></td>
                        <td>{{ "%.1f"|format(entry.amount_left_liters or 0) }}L</td>
                        <td>{{ entry.location or 'Unknown' }}</td>
                        <td>{{ entry.arrangement or 'Normal operation' }}</td>
                        <td>{{ entry.notes or '' }}</td>
                        <td>
                            {% if current_user.role_name == 'admin' %}
                            <a href="{{ url_for('edit_keg_history', keg_id=keg.id, history_id=entry.id) }}" 
                               class="btn btn-small btn-secondary">{{ _('Edit') }}</a>
                            <form action="{{ url_for('edit_keg_history', keg_id=keg.id, history_id=entry.id) }}" 
                                  method="POST" style="display: inline;"
                                  onsubmit="return confirm('{{ _('Are you sure you want to delete this history entry?') }}');">
                                <button type="submit" name="delete" value="true" class="btn btn-small btn-danger">{{ _('Delete') }}</button>
                            </form>
                            {% else %}
                            <span class="text-muted">-</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endif %}
    </div>
</div>

<style>
.badge-gluten-free {
    display: inline-block;
    background: linear-gradient(135deg, #4CAF50, #45a049);
    color: white;
    padding: 0.25rem 0.75rem;
    border-radius: 15px;
    font-weight: bold;
    font-size: 0.9rem;
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}

.keg-history {
    margin-top: 40px;
}

.keg-history h2 {
    color: #2c3e50;
    margin-bottom: 20px;
    padding-bottom: 10px;
    border-bottom: 2px solid #e9ecef;
}
</style>
{% endblock %}